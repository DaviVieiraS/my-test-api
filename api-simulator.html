<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Simulator - User Data Endpoint</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #007cba;
        }
        .endpoint-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .request-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            background: #007cba;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover {
            background: #005a87;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #218838;
        }
        .response-area {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid #007cba;
        }
        .response-success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .response-error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        pre {
            background: white;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        .links {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .links a {
            color: #007cba;
            text-decoration: none;
            margin: 0 15px;
        }
        .links a:hover {
            text-decoration: underline;
        }
        .sample-requests {
            margin-top: 20px;
        }
        .sample-btn {
            background: #6c757d;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .sample-btn:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì° API Simulator</h1>
            <p>Simulate POST requests to collect user data, device info, and status protocols</p>
        </div>

        <div class="endpoint-info">
            <h3>üìã API Endpoint Information</h3>
            <p><strong>Endpoint:</strong> <code>/api/user-data</code></p>
            <p><strong>Method:</strong> POST</p>
            <p><strong>Content-Type:</strong> application/json</p>
            <p><strong>Description:</strong> Submit user information, device data, and status protocols</p>
        </div>

        <div class="request-form">
            <h3>üìù Send User Data Request</h3>
            <form id="userDataForm">
                <div class="form-group">
                    <label for="action">Action Type:</label>
                    <select id="action" required>
                        <option value="register_user">Register New User</option>
                        <option value="update_device">Update Device Status</option>
                        <option value="report_status">Report Status Protocol</option>
                        <option value="heartbeat">Device Heartbeat</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="userId">User ID:</label>
                    <input type="number" id="userId" placeholder="Enter user ID">
                </div>

                <div class="form-group">
                    <label for="userName">User Name:</label>
                    <input type="text" id="userName" placeholder="Enter user name">
                </div>

                <div class="form-group">
                    <label for="userEmail">User Email:</label>
                    <input type="email" id="userEmail" placeholder="Enter user email">
                </div>

                <div class="form-group">
                    <label for="deviceNumber">Device Number:</label>
                    <input type="text" id="deviceNumber" placeholder="e.g., DEV001">
                </div>

                <div class="form-group">
                    <label for="deviceName">Device Name:</label>
                    <input type="text" id="deviceName" placeholder="e.g., iPhone 15 Pro">
                </div>

                <div class="form-group">
                    <label for="deviceStatus">Device Status:</label>
                    <select id="deviceStatus">
                        <option value="online">Online</option>
                        <option value="offline">Offline</option>
                        <option value="maintenance">Maintenance</option>
                        <option value="error">Error</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="protocol">Status Protocol:</label>
                    <select id="protocol">
                        <option value="HTTPS">HTTPS</option>
                        <option value="WebSocket">WebSocket</option>
                        <option value="MQTT">MQTT</option>
                        <option value="TCP">TCP</option>
                        <option value="UDP">UDP</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="userPlan">User Plan:</label>
                    <select id="userPlan">
                        <option value="Basic">Basic</option>
                        <option value="Premium">Premium</option>
                        <option value="Enterprise">Enterprise</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="additionalData">Additional Data (JSON):</label>
                    <textarea id="additionalData" rows="4" placeholder='{"location": "New York", "version": "1.2.3"}'></textarea>
                </div>

                <button type="submit">üì° Send API Request</button>
                <button type="button" onclick="clearForm()">üóëÔ∏è Clear Form</button>
            </form>

            <div class="sample-requests">
                <h4>üöÄ Sample Requests:</h4>
                <button class="sample-btn" onclick="loadSample('register')">Register User</button>
                <button class="sample-btn" onclick="loadSample('device')">Device Update</button>
                <button class="sample-btn" onclick="loadSample('heartbeat')">Heartbeat</button>
                <button class="sample-btn" onclick="loadSample('status')">Status Report</button>
            </div>
        </div>

        <div id="response" class="response-area" style="display: none;">
            <h3>üì§ API Response</h3>
            <div id="responseContent"></div>
        </div>

        <div class="links">
            <a href="index.html">üè† Home</a>
            <a href="dashboard.html">üìä Dashboard</a>
            <a href="post-viewer.html">üì® POST Viewer</a>
        </div>
    </div>

    <script>
        // Handle form submission
        document.getElementById('userDataForm').addEventListener('submit', function(e) {
            e.preventDefault();
            sendAPIRequest();
        });

        function sendAPIRequest() {
            const formData = {
                action: document.getElementById('action').value,
                userId: document.getElementById('userId').value,
                userName: document.getElementById('userName').value,
                userEmail: document.getElementById('userEmail').value,
                deviceNumber: document.getElementById('deviceNumber').value,
                deviceName: document.getElementById('deviceName').value,
                deviceStatus: document.getElementById('deviceStatus').value,
                protocol: document.getElementById('protocol').value,
                userPlan: document.getElementById('userPlan').value,
                timestamp: new Date().toISOString(),
                additionalData: {}
            };

            // Parse additional data if provided
            const additionalDataText = document.getElementById('additionalData').value.trim();
            if (additionalDataText) {
                try {
                    formData.additionalData = JSON.parse(additionalDataText);
                } catch (e) {
                    showResponse('error', 'Invalid JSON in additional data field');
                    return;
                }
            }

            // Simulate API processing
            const response = processAPIRequest(formData);
            
            // Store the request in localStorage for the dashboard
            storeRequest(formData, response);
            
            // Show response
            showResponse('success', response);
        }

        function processAPIRequest(data) {
            // Simulate server processing
            const timestamp = new Date().toISOString();
            
            switch (data.action) {
                case 'register_user':
                    return {
                        success: true,
                        message: 'User registered successfully',
                        userId: data.userId || Date.now(),
                        timestamp: timestamp,
                        data: {
                            user: {
                                name: data.userName,
                                email: data.userEmail,
                                plan: data.userPlan,
                                status: 'active'
                            }
                        }
                    };
                
                case 'update_device':
                    return {
                        success: true,
                        message: 'Device status updated',
                        deviceId: data.deviceNumber,
                        timestamp: timestamp,
                        data: {
                            device: {
                                number: data.deviceNumber,
                                name: data.deviceName,
                                status: data.deviceStatus,
                                protocol: data.protocol,
                                lastSeen: timestamp
                            }
                        }
                    };
                
                case 'report_status':
                    return {
                        success: true,
                        message: 'Status protocol reported',
                        timestamp: timestamp,
                        data: {
                            protocol: {
                                name: data.protocol,
                                status: data.deviceStatus,
                                device: data.deviceNumber
                            }
                        }
                    };
                
                case 'heartbeat':
                    return {
                        success: true,
                        message: 'Heartbeat received',
                        timestamp: timestamp,
                        data: {
                            heartbeat: {
                                device: data.deviceNumber,
                                status: 'alive',
                                protocol: data.protocol
                            }
                        }
                    };
                
                default:
                    return {
                        success: false,
                        message: 'Unknown action type',
                        timestamp: timestamp
                    };
            }
        }

        function storeRequest(requestData, response) {
            // Store in localStorage for dashboard
            const apiRequests = JSON.parse(localStorage.getItem('apiRequests') || '[]');
            
            apiRequests.push({
                id: Date.now(),
                timestamp: new Date().toISOString(),
                request: requestData,
                response: response,
                method: 'POST',
                endpoint: '/api/user-data'
            });
            
            localStorage.setItem('apiRequests', JSON.stringify(apiRequests));
            
            // Also update user/device data if applicable
            updateUserData(requestData, response);
        }

        function updateUserData(requestData, response) {
            if (requestData.action === 'register_user' && response.success) {
                // Add/update user
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const existingUserIndex = users.findIndex(u => u.id == requestData.userId);
                
                const userData = {
                    id: requestData.userId || Date.now(),
                    name: requestData.userName,
                    email: requestData.userEmail,
                    plan: requestData.userPlan,
                    joinDate: new Date().toISOString().split('T')[0],
                    status: 'active'
                };
                
                if (existingUserIndex >= 0) {
                    users[existingUserIndex] = userData;
                } else {
                    users.push(userData);
                }
                
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            if (requestData.action === 'update_device' && response.success) {
                // Add/update device
                const devices = JSON.parse(localStorage.getItem('devices') || '[]');
                const existingDeviceIndex = devices.findIndex(d => d.deviceNumber === requestData.deviceNumber);
                
                const deviceData = {
                    id: existingDeviceIndex >= 0 ? devices[existingDeviceIndex].id : Date.now(),
                    deviceNumber: requestData.deviceNumber,
                    userId: requestData.userId || 1,
                    deviceName: requestData.deviceName,
                    status: requestData.deviceStatus,
                    lastSeen: new Date().toISOString(),
                    protocol: requestData.protocol
                };
                
                if (existingDeviceIndex >= 0) {
                    devices[existingDeviceIndex] = deviceData;
                } else {
                    devices.push(deviceData);
                }
                
                localStorage.setItem('devices', JSON.stringify(devices));
            }
        }

        function showResponse(type, data) {
            const responseDiv = document.getElementById('response');
            const contentDiv = document.getElementById('responseContent');
            
            responseDiv.style.display = 'block';
            responseDiv.className = `response-area ${type === 'success' ? 'response-success' : 'response-error'}`;
            
            contentDiv.innerHTML = `
                <h4>${type === 'success' ? '‚úÖ Success' : '‚ùå Error'}</h4>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            
            // Scroll to response
            responseDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function clearForm() {
            document.getElementById('userDataForm').reset();
            document.getElementById('response').style.display = 'none';
        }

        function loadSample(type) {
            const samples = {
                register: {
                    action: 'register_user',
                    userName: 'John Doe',
                    userEmail: 'john@example.com',
                    userPlan: 'Premium',
                    deviceNumber: 'DEV001',
                    deviceName: 'iPhone 15 Pro',
                    deviceStatus: 'online',
                    protocol: 'HTTPS'
                },
                device: {
                    action: 'update_device',
                    userId: '1',
                    deviceNumber: 'DEV002',
                    deviceName: 'MacBook Pro',
                    deviceStatus: 'online',
                    protocol: 'WebSocket'
                },
                heartbeat: {
                    action: 'heartbeat',
                    deviceNumber: 'DEV001',
                    protocol: 'HTTPS',
                    additionalData: '{"battery": 85, "location": "Office"}'
                },
                status: {
                    action: 'report_status',
                    deviceNumber: 'DEV003',
                    protocol: 'MQTT',
                    deviceStatus: 'maintenance',
                    additionalData: '{"error": "Connection timeout", "retry_count": 3}'
                }
            };
            
            const sample = samples[type];
            if (sample) {
                Object.keys(sample).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = sample[key];
                    }
                });
            }
        }
    </script>
</body>
</html>
